<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script>
      $(function(){
        var frame = $("#recordFrame")[0];

        var recording = false;

        var events = [];

        $("#record").on("click", function(){
          frame.contentWindow.postMessage({
            type: "screenjsMessage",
            command: "record"
          },"*");
          recording = true;
        });
        $("#stopRecording").on("click", function(){
          frame.contentWindow.postMessage({
            type: "screenjsMessage",
            command: "stopRecording"
          },"*");
          recording = false;
        });

        window.addEventListener("message", receiveMessage, false);

        function receiveMessage(event)
        {
          if ( event.data && event.data.type && event.data.type == "screenjsMessage" ) {
            // TODO: Handle iframes
            if ( event.data.event && event.data.event == "screenjsLoaded" ) {
              if ( recording ) {
                frame.contentWindow.postMessage({
                  type: "screenjsMessage",
                  command: "record"
                },"*");
              }
            }
            else if ( event.data.event && event.data.event == "doneRecording" ) {
              events = events.concat(event.data.data);
              localStorage.events = JSON.stringify(events);
            }
            else if ( event.data.event && event.data.event == "donePage" ) {
              events = events.concat(event.data.data);
            }
          }
        }

      });
    </script>
  </head>
  <body>
    <button id="record">Record</button>
    <button id="stopRecording">Stop</button>
    <br />
    <!-- <iframe id="recordFrame" src="http://https.getclever.com.dev-proxy.castbin.com/" style="width:1056px;height:600px;border:1px solid #222;"></iframe> -->
    <iframe id="recordFrame" src="http://news.ycombinator.com.dev-proxy.castbin.com/item?id=6148424" style="width:1056px;height:600px;border:1px solid #222;"></iframe>
  </body>
</html>